<link rel="import" href="../bower_components/core-animated-pages/transitions/hero-transition.html">
<link rel="import" href="../bower_components/core-animated-pages/transitions/tile-cascade.html">
<link rel="import" href="../bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../bower_components/core-animated-pages/transitions/scale-up.html">
<link rel="import" href="../bower_components/core-elements/core-elements.html">
<link rel="import" href="../bower_components/google-signin/google-signin.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">
<link rel="import" href="../bower_components/polymer-filters/polymer-filters.html">
<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- fix for paper-elements#11 -->
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<polymer-element name="weighty-app" vertical layout>
  <template>
    <link rel="stylesheet" href="theme.css">
    <style>
      :host { display: block; }
      core-toolbar { background-color: transparent; }
    </style>
    <google-signin-dialog></google-signin-dialog>

    <dataset-list id="datasetList" datasets="{{ datasets }}"
      on-dataset-list-refresh-start="{{ refreshStart }}"
      on-dataset-list-refresh-end="{{ refreshEnd }}"
    ></dataset-list>

    <core-animated-pages flex id="pages"
      selected="{{ page }}"
      transitions="tile-cascade hero-transition cross-fade"
      on-core-animated-pages-transition-end="{{ endTransition }}"
    >
      <dataset-selector name="myDatasets"
        selected="{{ selectedDatasetIdx }}" datasets="{{ datasets }}"
      >
        <paper-icon-button controls icon="refresh" on-tap="{{ refresh }}"></paper-icon-button>
      </dataset-selector>

      <section name="dataset" fit scale-up>
        <template bind="{{ datasets[selectedDatasetIdx] }}">
          <dataset-page fit datasetId="{{ id }}" label="{{ title }}" cross-fade>
            <paper-icon-button controls icon="arrow-back" on-tap="{{ back }}"></paper-icon-button>
          </datasets-page>
        </template>
      </section>
    </core-animated-pages>
  </template>
  <script>
    Polymer({
      datasets: [],
      page: 'myDatasets',
      selectedDatasetIdx: null,

      selectedDatasetIdxChanged: function() {
        if(this.selectedDatasetIdx !== null) {
          this.page = 'dataset';
        }
      },

      refreshEnd: function() { },

      // Methods
      back: function() { this.page = 'myDatasets'; },
      refresh: function() {
        this.$.datasetList.refresh();
      },
      signout: function() {
        this.fire('core-signal', {
          name: 'google-signin-request-signout',
          data: null,
        });
      },
      endTransition: function() {
        if(this.page == 'myDatasets') {
          this.selectedDatasetIdx = null;
        }
      },
    });
  </script>
</polymer-element>
