<link rel="import" href="../bower_components/core-animated-pages/transitions/hero-transition.html">
<link rel="import" href="../bower_components/core-animated-pages/transitions/tile-cascade.html">
<link rel="import" href="../bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../bower_components/core-elements/core-elements.html">
<link rel="import" href="../bower_components/google-signin/google-signin.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">
<link rel="import" href="../bower_components/polymer-filters/polymer-filters.html">
<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- fix for paper-elements#11 -->
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<polymer-element name="weighty-app" vertical layout>
  <template>
    <link rel="stylesheet" href="theme.css">
    <style>
      :host { display: block; }
    </style>
    <google-signin-dialog></google-signin-dialog>

    <dataset-list id="datasetList" datasets="{{ datasets }}"></dataset-list>

    <core-animated-pages flex id="pages"
      selected="{{ (selectedDatasetIdx === null) ? 'myDatasets' : 'dataset' }}"
      transitions="hero-transition cross-fade tile-cascade"
    >
      <dataset-selector name="myDatasets"
        selected="{{ selectedDatasetIdx }}" datasets="{{ datasets }}"
      >
        <core-toolbar class="primary-a">
          <div flex>My Datasets</div>
          <paper-icon-button icon="refresh" on-tap="{{ refresh }}"></paper-icon-button>
        </core-toolbar>
      </dataset-selector>

      <section name="dataset" fit>
        <template bind="{{ datasets[selectedDatasetIdx] }}">
          <dataset-page fit datasetId="{{ id }}" cross-fade>
            <core-toolbar class="primary-b">
              <paper-icon-button icon="arrow-back" on-tap="{{ back }}"></paper-icon-button>
              <div flex>{{ title }}</div>
            </core-toolbar>
          </datasets-page>
        </template>
      </section>
    </core-animated-pages>
  </template>
  <script>
    Polymer({
      datasets: [],
      selectedDatasetIdx: null,

      // Methods
      back: function() { this.selectedDatasetIdx = null; },
      refresh: function() { this.$.datasetList.refresh(); },
      signout: function() {
        this.fire('core-signal', {
          name: 'google-signin-request-signout',
          data: null,
        });
      },
    });
  </script>
</polymer-element>
