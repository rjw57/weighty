<link rel="import" href="../bower_components/core-elements/core-elements.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">
<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- fix for paper-elements#11 -->
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<link rel="import" href="elements.html">

<polymer-element name="weighty-app" attributes="datasets" vertical layout>
  <template>
    <link rel="stylesheet" href="theme.css">
    <style>
      :host { display: block; }
      core-toolbar { background-color: transparent; }
    </style>

    <core-animated-pages flex id="pages"
      selected="{{ page }}"
      transitions="hero-transition cross-fade"
      on-core-animated-pages-transition-end="{{ endTransition }}"
    >
      <dataset-selector name="myDatasets"
        selected="{{ selectedDatasetIdx }}" datasets="{{ datasets }}"
      >
        <paper-icon-button controls icon="refresh" on-tap="{{ refresh }}"></paper-icon-button>
      </dataset-selector>

      <section name="dataset">
        <template bind="{{ datasets[selectedDatasetIdx] }}">
          <dataset-page fit datasetId="{{ id }}" label="{{ title }}" cross-fade>
            <paper-icon-button controls icon="arrow-back" on-tap="{{ back }}"></paper-icon-button>
          </datasets-page>
        </template>
      </section>
    </core-animated-pages>
  </template>
  <script>
    Polymer({
      page: 'myDatasets',
      selectedDatasetIdx: null,

      selectedDatasetIdxChanged: function() {
        if(this.selectedDatasetIdx !== null) {
          this.page = 'dataset';
        }
      },

      // Methods
      back: function() { this.page = 'myDatasets'; },
      signout: function() {
        this.fire('core-signal', {
          name: 'google-signin-request-signout',
          data: null,
        });
      },
      endTransition: function() {
        if(this.page == 'myDatasets') {
          this.selectedDatasetIdx = null;
        }
      },
    });
  </script>
</polymer-element>
